# 2021 January 01
#
# The author disclaims copyright to this source code.  In place of
# a legal notice, here is a blessing:
#
#    May you do good and not evil.
#    May you find forgiveness for yourself and forgive others.
#    May you share freely, never taking more than you give.
#
#*************************************************************************
# This file implements regression tests for SQLite library.
#

set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix hct_simple_rollback

foreach {tn str1 str2} {
  1 "abcdefghij" "ABCDEFGHIJ"
} {
  hct_reset_db
  sqlite3 db2 test.db

  do_execsql_test 1.0 {
    CREATE TABLE t1(a INTEGER PRIMARY KEY, b TEXT);
    CREATE TABLE t2(a INTEGER PRIMARY KEY, b TEXT);

    INSERT INTO t1 VALUES(13, $str1);
  }

  do_execsql_test -db db2 1.1 {
    SELECT b FROM t1 WHERE a=13
  } [list $str1]

  do_execsql_test 1.2 {
    BEGIN;
      UPDATE t1 SET b = $str2 WHERE a = 13;
      INSERT INTO t2 VALUES(1, 'hello');
  }

  do_execsql_test -db db2 1.3 {
    INSERT INTO t2 VALUES(1, 'world');
  }

  do_catchsql_test 1.4 {
    COMMIT;
  } {1 {database is locked}}
}


finish_test



